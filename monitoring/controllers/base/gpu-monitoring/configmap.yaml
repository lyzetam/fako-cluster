# monitoring/controllers/base/gpu-monitoring/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: dcgm-exporter-config
  namespace: gpu-monitoring
data:
  default-counters.csv: |
    # DCGM Fields for comprehensive GPU monitoring
    # Format: DCGM_FI_[FIELD_NAME], Prometheus metric type, Prometheus metric name

    # GPU Utilization
    DCGM_FI_DEV_GPU_UTIL, gauge, gpu_utilization
    DCGM_FI_DEV_MEM_COPY_UTIL, gauge, gpu_memory_copy_utilization
    DCGM_FI_DEV_ENC_UTIL, gauge, gpu_encoder_utilization
    DCGM_FI_DEV_DEC_UTIL, gauge, gpu_decoder_utilization

    # Memory
    DCGM_FI_DEV_FB_FREE, gauge, gpu_memory_free_bytes
    DCGM_FI_DEV_FB_USED, gauge, gpu_memory_used_bytes
    DCGM_FI_DEV_FB_TOTAL, gauge, gpu_memory_total_bytes

    # Temperature & Power
    DCGM_FI_DEV_GPU_TEMP, gauge, gpu_temperature_celsius
    DCGM_FI_DEV_MEMORY_TEMP, gauge, gpu_memory_temperature_celsius
    DCGM_FI_DEV_POWER_USAGE, gauge, gpu_power_usage_watts
    DCGM_FI_DEV_TOTAL_ENERGY_CONSUMPTION, counter, gpu_energy_consumption_millijoules

    # Clocks
    DCGM_FI_DEV_SM_CLOCK, gauge, gpu_sm_clock_hz
    DCGM_FI_DEV_MEM_CLOCK, gauge, gpu_memory_clock_hz

    # PCIe
    DCGM_FI_DEV_PCIE_TX_THROUGHPUT, counter, gpu_pcie_tx_bytes_total
    DCGM_FI_DEV_PCIE_RX_THROUGHPUT, counter, gpu_pcie_rx_bytes_total
    DCGM_FI_DEV_PCIE_REPLAY_COUNTER, counter, gpu_pcie_replay_counter_total

    # Compute
    DCGM_FI_PROF_GR_ENGINE_ACTIVE, gauge, gpu_gr_engine_active_ratio
    DCGM_FI_PROF_SM_ACTIVE, gauge, gpu_sm_active_ratio
    DCGM_FI_PROF_SM_OCCUPANCY, gauge, gpu_sm_occupancy_ratio
    DCGM_FI_PROF_PIPE_TENSOR_ACTIVE, gauge, gpu_tensor_core_active_ratio
    DCGM_FI_PROF_PIPE_FP64_ACTIVE, gauge, gpu_fp64_active_ratio
    DCGM_FI_PROF_PIPE_FP32_ACTIVE, gauge, gpu_fp32_active_ratio
    DCGM_FI_PROF_PIPE_FP16_ACTIVE, gauge, gpu_fp16_active_ratio

    # Errors and Events
    DCGM_FI_DEV_XID_ERRORS, counter, gpu_xid_errors_total
    DCGM_FI_DEV_NVLINK_CRC_FLIT_ERROR_COUNT_TOTAL, counter, gpu_nvlink_flit_crc_errors_total
    DCGM_FI_DEV_NVLINK_CRC_DATA_ERROR_COUNT_TOTAL, counter, gpu_nvlink_data_crc_errors_total
    DCGM_FI_DEV_NVLINK_REPLAY_ERROR_COUNT_TOTAL, counter, gpu_nvlink_replay_errors_total
    DCGM_FI_DEV_NVLINK_RECOVERY_ERROR_COUNT_TOTAL, counter, gpu_nvlink_recovery_errors_total
    DCGM_FI_DEV_RETIRED_SBE, counter, gpu_retired_pages_sbe_total
    DCGM_FI_DEV_RETIRED_DBE, counter, gpu_retired_pages_dbe_total
