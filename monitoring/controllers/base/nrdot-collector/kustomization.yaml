apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - namespace.yaml
  - aws-credentials-secret.yaml
  - aws-secret-store.yaml
  - external-secret-license.yaml
  - release.yaml
  - repository.yaml
  - instrumentation.yaml

# Set namespace for all resources except HelmRepository (overridden in patch)
namespace: nrdot-collector

# Patch HelmRepository to use flux-system namespace instead of nrdot-collector
patches:
  - patch: |-
      - op: replace
        path: /metadata/namespace
        value: flux-system
    target:
      kind: HelmRepository
      name: newrelic
