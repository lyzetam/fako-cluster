apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: newrelic-bundle
  namespace: nrdot-collector
spec:
  interval: 5m
  chart:
    spec:
      chart: nri-bundle
      version: ">=5.0.0"
      sourceRef:
        kind: HelmRepository
        name: newrelic
        namespace: flux-system
      interval: 1m
  valuesFrom:
  - kind: Secret
    name: newrelic-license-key
    valuesKey: license-key
    targetPath: global.licenseKey
  values:
    global:
      cluster: "Fako-cluster"
      lowDataMode: true
      privileged: true
      verboseLog: false
    
    # Infrastructure agent
    newrelic-infrastructure:
      enabled: true
    
    # Prometheus scraping (disabled - using prometheus-agent instead)
    nri-prometheus:
      enabled: false
    
    # Metadata injection for APM correlation
    nri-metadata-injection:
      enabled: true
    
    # Kube-state-metrics
    kube-state-metrics:
      enabled: true
    
    # Kubernetes events
    nri-kube-events:
      enabled: true
    
    # Logging (disabled - using Loki instead for cost savings)
    newrelic-logging:
      enabled: false
    
    # Pixie integration (disabled - using separate Pixie deployment)
    newrelic-pixie:
      enabled: false
    
    pixie-chart:
      enabled: false
    
    # Infrastructure operator (Beta)
    newrelic-infra-operator:
      enabled: false
    
    # Prometheus agent for metric scraping
    newrelic-prometheus-agent:
      enabled: true
    
    # eBPF agent for APM auto-instrumentation (Beta)
    newrelic-eapm-agent:
      enabled: true
      config:
        # Auto-instrument Java, Node.js, Python, Ruby, .NET apps
        # Monitor all namespaces by default
        enabledNamespaces: ["*"]
    
    # K8s agents operator for auto-instrumentation
    k8s-agents-operator:
      enabled: true
    
    # Metrics adapter (Beta)
    newrelic-k8s-metrics-adapter:
      enabled: false
