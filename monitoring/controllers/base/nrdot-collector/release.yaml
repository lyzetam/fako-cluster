apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: nrdot-collector
  namespace: nrdot-collector
spec:
  interval: 5m
  chart:
    spec:
      chart: nri-kubernetes
      version: ">=5.0.0"
      sourceRef:
        kind: HelmRepository
        name: newrelic
        namespace: flux-system
      interval: 1m
  valuesFrom:
  - kind: Secret
    name: newrelic-license-key
    valuesKey: license-key
    targetPath: global.licenseKey
  values:
    global:
      cluster: "Fako-cluster"
      lowDataMode: false
    
    # Enable Kubernetes metrics and events collection
    ksm:
      enabled: true
    
    kubeStateMetrics:
      enabled: true
    
    # Enable infrastructure monitoring
    infrastructure:
      enabled: true
    
    # Enable Prometheus integration
    prometheus:
      enabled: true
    
    # Enable logging
    logging:
      enabled: true
    
    # Resource limits for the DaemonSet
    common:
      agentConfig:
        resources:
          limits:
            memory: 1Gi
            cpu: 500m
          requests:
            memory: 512Mi
            cpu: 100m
    
    # Enable verbose logging for troubleshooting (can be disabled later)
    verboseLog: false
