apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: family-manager-secrets
  namespace: family-manager
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secret-store
    kind: SecretStore
  target:
    name: family-manager-secrets
    creationPolicy: Owner
  data:
    # Discord
    - secretKey: DISCORD_BOT_TOKEN
      remoteRef:
        key: family-manager-bot/discord
        property: bot_token
    - secretKey: DISCORD_GUILD_ID
      remoteRef:
        key: family-manager-bot/discord
        property: guild_id
    # Anthropic
    - secretKey: ANTHROPIC_API_KEY
      remoteRef:
        key: family-manager-bot/anthropic
        property: api_key
    # ElevenLabs
    - secretKey: ELEVENLABS_API_KEY
      remoteRef:
        key: elevenlabs/api-key
        property: api_key
    # Nylas
    - secretKey: NYLAS_API_KEY
      remoteRef:
        key: nylas/api-key
    - secretKey: NYLAS_GRANT_ID
      remoteRef:
        key: nylas/grant-id
    # Twilio
    - secretKey: TWILIO_ACCOUNT_SID
      remoteRef:
        key: twilio/account-sid
    - secretKey: TWILIO_AUTH_TOKEN
      remoteRef:
        key: twilio/auth-token
    - secretKey: TWILIO_PHONE_NUMBER
      remoteRef:
        key: twilio/phone-number
    - secretKey: TWILIO_LANDRY_CELL
      remoteRef:
        key: twilio/landry-cell
    - secretKey: TWILIO_WIFE_CELL
      remoteRef:
        key: twilio/wife-cell
    # Phone lines (dual-line system)
    - secretKey: TWILIO_PRIVATE_LINE
      remoteRef:
        key: twilio/private-line
        property: private_line
    - secretKey: TWILIO_PUBLIC_LINE
      remoteRef:
        key: twilio/public-line
        property: public_line
    # Webhook Authentication
    - secretKey: ELEVENLABS_WEBHOOK_SECRET
      remoteRef:
        key: family-manager-bot/webhooks
        property: elevenlabs_secret
    - secretKey: RETELL_WEBHOOK_SECRET
      remoteRef:
        key: family-manager-bot/webhooks
        property: retell_secret
    - secretKey: INTERNAL_API_KEY
      remoteRef:
        key: family-manager-bot/webhooks
        property: internal_api_key
    # Supabase (for cloud memory persistence)
    - secretKey: SUPABASE_URL
      remoteRef:
        key: family-manager-bot/supabase
        property: url
    - secretKey: SUPABASE_ANON_KEY
      remoteRef:
        key: family-manager-bot/supabase
        property: anon_key
    - secretKey: SUPABASE_SERVICE_ROLE_KEY
      remoteRef:
        key: family-manager-bot/supabase
        property: service_role_key
    # Amadeus (for flight/hotel search)
    - secretKey: AMADEUS_CLIENT_ID
      remoteRef:
        key: amadeus/api-credentials
        property: apikey
    - secretKey: AMADEUS_CLIENT_SECRET
      remoteRef:
        key: amadeus/api-credentials
        property: apisecret
    # Ollama (LLM for intent classification and agents)
    - secretKey: OLLAMA_BASE_URL
      remoteRef:
        key: family-manager-bot/ollama
        property: base_url
    - secretKey: OLLAMA_MODEL
      remoteRef:
        key: family-manager-bot/ollama
        property: model
    # Brave Search (for web/local search)
    - secretKey: BRAVE_API_KEY
      remoteRef:
        key: brave/search-api-credentials
        property: apikey
    # Family PINs (for voice authentication)
    - secretKey: FAMILY_PINS
      remoteRef:
        key: family-manager-bot/family-pins
---
# Cloudflare tunnel credentials for dedicated family-manager tunnel
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: tunnel-credentials
  namespace: family-manager
spec:
  refreshInterval: 24h
  secretStoreRef:
    name: aws-secret-store
    kind: SecretStore
  target:
    name: tunnel-credentials
    creationPolicy: Owner
    template:
      data:
        credentials.json: "{{ .credentials | toString }}"
  data:
    - secretKey: credentials
      remoteRef:
        key: family-manager-bot/cloudflare-tunnel
