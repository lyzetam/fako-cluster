apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: thornus-external-secret
  namespace: thornus
spec:
  secretStoreRef:
    name: aws-secrets-store
    kind: SecretStore
  target:
    name: thornus-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        SUPABASE_URL: "{{ .supabase_url }}"
        SUPABASE_ANON_KEY: "{{ .supabase_anon_key }}"
        SUPABASE_SERVICE_ROLE_KEY: "{{ .supabase_service_role_key }}"
        ANTHROPIC_API_KEY: "{{ .anthropic_api_key }}"
        N8N_API_KEY: "{{ .n8n_api_key }}"
        STRIPE_API_KEY: "{{ .stripe_api_key }}"
        STRIPE_WEBHOOK_SECRET: "{{ .stripe_webhook_secret }}"
        RESEND_API_KEY: "{{ .resend_api_key }}"
        CLOUDFLARE_API_TOKEN: "{{ .cloudflare_api_token }}"
        DIGITALOCEAN_API_TOKEN: "{{ .digitalocean_api_token }}"
  data:
    - secretKey: supabase_url
      remoteRef:
        key: thornus/supabase
        property: url
    - secretKey: supabase_anon_key
      remoteRef:
        key: thornus/supabase
        property: anon_key
    - secretKey: supabase_service_role_key
      remoteRef:
        key: thornus/supabase
        property: service_role_key
    - secretKey: anthropic_api_key
      remoteRef:
        key: thornus/api-keys
        property: ANTHROPIC_API_KEY
    - secretKey: n8n_api_key
      remoteRef:
        key: thornus/api-keys
        property: N8N_API_KEY
    - secretKey: stripe_api_key
      remoteRef:
        key: thornus/stripe
        property: api_key
    - secretKey: stripe_webhook_secret
      remoteRef:
        key: thornus/stripe
        property: webhook_secret
    - secretKey: resend_api_key
      remoteRef:
        key: thornus/api-keys
        property: RESEND_API_KEY
    - secretKey: cloudflare_api_token
      remoteRef:
        key: cloudflare/api-token
    - secretKey: digitalocean_api_token
      remoteRef:
        key: thornus/api-keys
        property: DIGITALOCEAN_API_TOKEN
  refreshInterval: 1h
