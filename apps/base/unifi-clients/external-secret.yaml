apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: unifi-clients-credentials
  namespace: unifi-clients
spec:
  secretStoreRef:
    name: aws-secret-store
    kind: SecretStore
  target:
    name: unifi-clients-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        UNIFI_IP: "{{ .unifi_ip }}"
        UNIFI_PORT: "{{ .unifi_port }}"
        UNIFI_USERNAME: "{{ .unifi_username }}"
        UNIFI_PASSWORD: "{{ .unifi_password }}"
        AWS_REGION: "{{ .aws_region }}"
        S3_BUCKET: "{{ .s3_bucket }}"
        AWS_ACCESS_KEY_ID: "{{ .aws_access_key_id }}"
        AWS_SECRET_ACCESS_KEY: "{{ .aws_secret_access_key }}"
  data:
    - secretKey: unifi_ip
      remoteRef:
        key: unifi-clients/credentials
        property: unifi_ip
    - secretKey: unifi_port
      remoteRef:
        key: unifi-clients/credentials
        property: unifi_port
    - secretKey: unifi_username
      remoteRef:
        key: unifi-clients/credentials
        property: unifi_username
    - secretKey: unifi_password
      remoteRef:
        key: unifi-clients/credentials
        property: unifi_password
    - secretKey: aws_region
      remoteRef:
        key: unifi-clients/credentials
        property: aws_region
    - secretKey: s3_bucket
      remoteRef:
        key: unifi-clients/credentials
        property: s3_bucket
    - secretKey: aws_access_key_id
      remoteRef:
        key: unifi-clients/credentials
        property: aws_access_key_id
    - secretKey: aws_secret_access_key
      remoteRef:
        key: unifi-clients/credentials
        property: aws_secret_access_key
  refreshInterval: 1h
