apiVersion: apps/v1
kind: Deployment
metadata:
  name: zi
  namespace: zi
  labels:
    app.kubernetes.io/name: zi
    app.kubernetes.io/component: orchestrator
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: zi
  template:
    metadata:
      labels:
        app.kubernetes.io/name: zi
        app.kubernetes.io/component: orchestrator
    spec:
      serviceAccountName: zi
      imagePullSecrets:
        - name: dockerhub-registry
      initContainers:
        - name: setup-brain-storage
          image: busybox:latest
          command:
            - sh
            - -c
            - |
              mkdir -p /data/brain/zi/journal /data/brain/skills
              chmod -R 777 /data/brain
          volumeMounts:
            - name: brain-storage
              mountPath: /data/brain
      containers:
        - name: zi
          image: lzetam/zi:latest
          imagePullPolicy: Always
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
          env:
            - name: ZI_HOST
              value: "0.0.0.0"
            - name: ZI_PORT
              value: "8080"
            - name: ZI_BRAIN_URL
              value: "http://zi-brain:8100"
            - name: ZI_REDIS_HOST
              value: "redis"
            - name: ZI_REDIS_PORT
              value: "6379"
            - name: ZI_OLLAMA_URL
              value: "http://ms3.landryzetam.net:11434"
            - name: ZI_AGENT_MEMORY_PATH
              value: "/data/agents"
            - name: ZI_AGENT_CONFIG_PATH
              value: "/config/agents.yaml"
            - name: ZI_BRAIN_PATH
              value: "/data/brain"
            - name: ZI_AUDIT_ENABLED
              value: "true"
            - name: ZI_SKILLS_DIR
              value: "/data/brain/skills"
            # Langfuse LLM observability
            - name: LANGFUSE_PUBLIC_KEY
              valueFrom:
                secretKeyRef:
                  name: langfuse-agent-keys
                  key: public_key
            - name: LANGFUSE_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: langfuse-agent-keys
                  key: secret_key
            - name: LANGFUSE_BASE_URL
              value: "http://langfuse-web.langfuse.svc:3000"
          envFrom:
            - secretRef:
                name: zi-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "1Gi"
              cpu: "500m"
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 10
            periodSeconds: 30
            timeoutSeconds: 5
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
            timeoutSeconds: 3
          volumeMounts:
            # Brain storage for journal and second-brain data
            - name: brain-storage
              mountPath: /data/brain
            # Agent config
            - name: agent-config
              mountPath: /config
              readOnly: true
            # Agent memory PVCs (61 agents)
            - name: account-executive-memory
              mountPath: /data/agents/account_executive/memory
            - name: ai-engineer-memory
              mountPath: /data/agents/ai_engineer/memory
            - name: ap-specialist-memory
              mountPath: /data/agents/ap_specialist/memory
            - name: app-security-memory
              mountPath: /data/agents/app_security/memory
            - name: app-sre-memory
              mountPath: /data/agents/app_sre/memory
            - name: ar-manager-memory
              mountPath: /data/agents/ar_manager/memory
            - name: backend-engineer-memory
              mountPath: /data/agents/backend_engineer/memory
            - name: business-development-rep-memory
              mountPath: /data/agents/business_development_rep/memory
            - name: business-operations-manager-memory
              mountPath: /data/agents/business_operations_manager/memory
            - name: competitive-analyst-memory
              mountPath: /data/agents/competitive_analyst/memory
            - name: cloud-engineer-memory
              mountPath: /data/agents/cloud_engineer/memory
            - name: code-reviewer-memory
              mountPath: /data/agents/code_reviewer/memory
            - name: communications-director-memory
              mountPath: /data/agents/communications_director/memory
            - name: content-manager-memory
              mountPath: /data/agents/content_manager/memory
            - name: controller-memory
              mountPath: /data/agents/controller/memory
            - name: creative-director-memory
              mountPath: /data/agents/creative_director/memory
            - name: cs-director-memory
              mountPath: /data/agents/cs_director/memory
            - name: cs-operations-analyst-memory
              mountPath: /data/agents/cs_operations_analyst/memory
            - name: customer-education-manager-memory
              mountPath: /data/agents/customer_education_manager/memory
            - name: customer-success-manager-memory
              mountPath: /data/agents/customer_success_manager/memory
            - name: data-engineer-memory
              mountPath: /data/agents/data_engineer/memory
            - name: devops-engineer-memory
              mountPath: /data/agents/devops_engineer/memory
            - name: digital-marketing-manager-memory
              mountPath: /data/agents/digital_marketing_manager/memory
            - name: financial-analyst-memory
              mountPath: /data/agents/financial_analyst/memory
            - name: fpa-manager-memory
              mountPath: /data/agents/fpa_manager/memory
            - name: frontend-engineer-memory
              mountPath: /data/agents/frontend_engineer/memory
            - name: head-of-design-memory
              mountPath: /data/agents/head_of_design/memory
            - name: governance-engine-memory
              mountPath: /data/agents/governance_engine/memory
            - name: hr-manager-memory
              mountPath: /data/agents/hr_manager/memory
            - name: k8s-engineer-memory
              mountPath: /data/agents/k8s_engineer/memory
            - name: legal-counsel-memory
              mountPath: /data/agents/legal_counsel/memory
            - name: market-researcher-memory
              mountPath: /data/agents/market_researcher/memory
            - name: marketing-operations-manager-memory
              mountPath: /data/agents/marketing_operations_manager/memory
            - name: onboarding-manager-memory
              mountPath: /data/agents/onboarding_manager/memory
            - name: platform-security-memory
              mountPath: /data/agents/platform_security/memory
            - name: platform-sre-memory
              mountPath: /data/agents/platform_sre/memory
            - name: pr-manager-memory
              mountPath: /data/agents/pr_manager/memory
            - name: procurement-manager-memory
              mountPath: /data/agents/procurement_manager/memory
            - name: product-manager-memory
              mountPath: /data/agents/product_manager/memory
            - name: product-marketing-manager-memory
              mountPath: /data/agents/product_marketing_manager/memory
            - name: product-operations-manager-memory
              mountPath: /data/agents/product_operations_manager/memory
            - name: project-manager-memory
              mountPath: /data/agents/project_manager/memory
            - name: qa-engineer-memory
              mountPath: /data/agents/qa_engineer/memory
            - name: recruiter-memory
              mountPath: /data/agents/recruiter/memory
            - name: sales-development-rep-memory
              mountPath: /data/agents/sales_development_rep/memory
            - name: sales-enablement-manager-memory
              mountPath: /data/agents/sales_enablement_manager/memory
            - name: sales-manager-memory
              mountPath: /data/agents/sales_manager/memory
            - name: sales-operations-analyst-memory
              mountPath: /data/agents/sales_operations_analyst/memory
            - name: sdr-manager-memory
              mountPath: /data/agents/sdr_manager/memory
            - name: security-engineer-memory
              mountPath: /data/agents/security_engineer/memory
            - name: senior-product-manager-memory
              mountPath: /data/agents/senior_product_manager/memory
            - name: social-media-manager-memory
              mountPath: /data/agents/social_media_manager/memory
            - name: solutions-architect-memory
              mountPath: /data/agents/solutions_architect/memory
            - name: support-manager-memory
              mountPath: /data/agents/support_manager/memory
            - name: support-representative-memory
              mountPath: /data/agents/support_representative/memory
            - name: tech-lead-memory
              mountPath: /data/agents/tech_lead/memory
            - name: tech-writer-memory
              mountPath: /data/agents/tech_writer/memory
            - name: technical-product-manager-memory
              mountPath: /data/agents/technical_product_manager/memory
            - name: technical-support-specialist-memory
              mountPath: /data/agents/technical_support_specialist/memory
            - name: ux-designer-memory
              mountPath: /data/agents/ux_designer/memory
            - name: ux-researcher-memory
              mountPath: /data/agents/ux_researcher/memory
      volumes:
        # Brain storage for journal and data
        - name: brain-storage
          persistentVolumeClaim:
            claimName: zi-brain-storage
        # Agent config from ConfigMap
        - name: agent-config
          configMap:
            name: zi-config
        # Agent memory PVCs (61 agents)
        - name: account-executive-memory
          persistentVolumeClaim:
            claimName: account-executive-memory
        - name: ai-engineer-memory
          persistentVolumeClaim:
            claimName: ai-engineer-memory
        - name: ap-specialist-memory
          persistentVolumeClaim:
            claimName: ap-specialist-memory
        - name: app-security-memory
          persistentVolumeClaim:
            claimName: app-security-memory
        - name: app-sre-memory
          persistentVolumeClaim:
            claimName: app-sre-memory
        - name: ar-manager-memory
          persistentVolumeClaim:
            claimName: ar-manager-memory
        - name: backend-engineer-memory
          persistentVolumeClaim:
            claimName: backend-engineer-memory
        - name: business-development-rep-memory
          persistentVolumeClaim:
            claimName: business-development-rep-memory
        - name: business-operations-manager-memory
          persistentVolumeClaim:
            claimName: business-operations-manager-memory
        - name: competitive-analyst-memory
          persistentVolumeClaim:
            claimName: competitive-analyst-memory
        - name: cloud-engineer-memory
          persistentVolumeClaim:
            claimName: cloud-engineer-memory
        - name: code-reviewer-memory
          persistentVolumeClaim:
            claimName: code-reviewer-memory
        - name: communications-director-memory
          persistentVolumeClaim:
            claimName: communications-director-memory
        - name: content-manager-memory
          persistentVolumeClaim:
            claimName: content-manager-memory
        - name: controller-memory
          persistentVolumeClaim:
            claimName: controller-memory
        - name: creative-director-memory
          persistentVolumeClaim:
            claimName: creative-director-memory
        - name: cs-director-memory
          persistentVolumeClaim:
            claimName: cs-director-memory
        - name: cs-operations-analyst-memory
          persistentVolumeClaim:
            claimName: cs-operations-analyst-memory
        - name: customer-education-manager-memory
          persistentVolumeClaim:
            claimName: customer-education-manager-memory
        - name: customer-success-manager-memory
          persistentVolumeClaim:
            claimName: customer-success-manager-memory
        - name: data-engineer-memory
          persistentVolumeClaim:
            claimName: data-engineer-memory
        - name: devops-engineer-memory
          persistentVolumeClaim:
            claimName: devops-engineer-memory
        - name: digital-marketing-manager-memory
          persistentVolumeClaim:
            claimName: digital-marketing-manager-memory
        - name: financial-analyst-memory
          persistentVolumeClaim:
            claimName: financial-analyst-memory
        - name: fpa-manager-memory
          persistentVolumeClaim:
            claimName: fpa-manager-memory
        - name: frontend-engineer-memory
          persistentVolumeClaim:
            claimName: frontend-engineer-memory
        - name: head-of-design-memory
          persistentVolumeClaim:
            claimName: head-of-design-memory
        - name: governance-engine-memory
          persistentVolumeClaim:
            claimName: governance-engine-memory
        - name: hr-manager-memory
          persistentVolumeClaim:
            claimName: hr-manager-memory
        - name: k8s-engineer-memory
          persistentVolumeClaim:
            claimName: k8s-engineer-memory
        - name: legal-counsel-memory
          persistentVolumeClaim:
            claimName: legal-counsel-memory
        - name: market-researcher-memory
          persistentVolumeClaim:
            claimName: market-researcher-memory
        - name: marketing-operations-manager-memory
          persistentVolumeClaim:
            claimName: marketing-operations-manager-memory
        - name: onboarding-manager-memory
          persistentVolumeClaim:
            claimName: onboarding-manager-memory
        - name: platform-security-memory
          persistentVolumeClaim:
            claimName: platform-security-memory
        - name: platform-sre-memory
          persistentVolumeClaim:
            claimName: platform-sre-memory
        - name: pr-manager-memory
          persistentVolumeClaim:
            claimName: pr-manager-memory
        - name: procurement-manager-memory
          persistentVolumeClaim:
            claimName: procurement-manager-memory
        - name: product-manager-memory
          persistentVolumeClaim:
            claimName: product-manager-memory
        - name: product-marketing-manager-memory
          persistentVolumeClaim:
            claimName: product-marketing-manager-memory
        - name: product-operations-manager-memory
          persistentVolumeClaim:
            claimName: product-operations-manager-memory
        - name: project-manager-memory
          persistentVolumeClaim:
            claimName: project-manager-memory
        - name: qa-engineer-memory
          persistentVolumeClaim:
            claimName: qa-engineer-memory
        - name: recruiter-memory
          persistentVolumeClaim:
            claimName: recruiter-memory
        - name: sales-development-rep-memory
          persistentVolumeClaim:
            claimName: sales-development-rep-memory
        - name: sales-enablement-manager-memory
          persistentVolumeClaim:
            claimName: sales-enablement-manager-memory
        - name: sales-manager-memory
          persistentVolumeClaim:
            claimName: sales-manager-memory
        - name: sales-operations-analyst-memory
          persistentVolumeClaim:
            claimName: sales-operations-analyst-memory
        - name: sdr-manager-memory
          persistentVolumeClaim:
            claimName: sdr-manager-memory
        - name: security-engineer-memory
          persistentVolumeClaim:
            claimName: security-engineer-memory
        - name: senior-product-manager-memory
          persistentVolumeClaim:
            claimName: senior-product-manager-memory
        - name: social-media-manager-memory
          persistentVolumeClaim:
            claimName: social-media-manager-memory
        - name: solutions-architect-memory
          persistentVolumeClaim:
            claimName: solutions-architect-memory
        - name: support-manager-memory
          persistentVolumeClaim:
            claimName: support-manager-memory
        - name: support-representative-memory
          persistentVolumeClaim:
            claimName: support-representative-memory
        - name: tech-lead-memory
          persistentVolumeClaim:
            claimName: tech-lead-memory
        - name: tech-writer-memory
          persistentVolumeClaim:
            claimName: tech-writer-memory
        - name: technical-product-manager-memory
          persistentVolumeClaim:
            claimName: technical-product-manager-memory
        - name: technical-support-specialist-memory
          persistentVolumeClaim:
            claimName: technical-support-specialist-memory
        - name: ux-designer-memory
          persistentVolumeClaim:
            claimName: ux-designer-memory
        - name: ux-researcher-memory
          persistentVolumeClaim:
            claimName: ux-researcher-memory
