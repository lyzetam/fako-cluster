apiVersion: v1
kind: ConfigMap
metadata:
  name: kubescape-nginx-config
  namespace: kubescape
  labels:
    app.kubernetes.io/name: kubescape
    app.kubernetes.io/part-of: security
data:
  default.conf: |
    server {
        listen 80;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html;

        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
        add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept";

        location / {
            return 200 '<html><head><title>Kubescape Dashboard</title></head><body><h1>Kubescape Security Dashboard</h1><p>Access scan results at <a href="/results/">/results/</a></p><p>Health check at <a href="/health">/health</a></p></body></html>';
            add_header Content-Type text/html;
        }

        location /results/ {
            alias /usr/share/nginx/html/results/;
            autoindex on;
            autoindex_format json;
        }

        location /health {
            return 200 '{"status":"ok","service":"kubescape"}';
            add_header Content-Type application/json;
        }
    }
