apiVersion: batch/v1
kind: Job
metadata:
  name: postgres-fix-permissions
  namespace: postgres
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: Never
      securityContext:
        runAsUser: 0  # Run as root to change ownership
      containers:
      - name: fix-permissions
        image: alpine:latest
        command:
        - /bin/sh
        - -c
        - |
          echo "Fixing permissions on /data..."
          chown -R 26:26 /data
          chmod 700 /data
          echo "Permissions fixed successfully!"
          ls -la /data
          echo "Done!"
        volumeMounts:
        - name: pgdata
          mountPath: /data
      volumes:
      - name: pgdata
        persistentVolumeClaim:
          claimName: postgres-cluster-1
