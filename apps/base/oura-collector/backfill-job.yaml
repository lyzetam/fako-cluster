apiVersion: batch/v1
kind: Job
metadata:
  name: oura-collector-backfill
  namespace: oura-collector
spec:
  ttlSecondsAfterFinished: 86400
  template:
    spec:
      containers:
      - name: oura-collector
        image: lzetam/oura-collector:latest
        imagePullPolicy: IfNotPresent
        env:
        - name: STORAGE_BACKEND
          value: postgres
        - name: DATABASE_HOST
          value: postgres-cluster-rw.postgres.svc.cluster.local
        - name: DATABASE_NAME
          value: oura
        - name: OURA_SECRETS_NAME
          value: oura/api-credentials
        - name: POSTGRES_SECRETS_NAME
          value: postgres/app-user
        - name: DAYS_TO_BACKFILL
          value: "1095"
        - name: RUN_ONCE
          value: "true"
        - name: LOG_LEVEL
          value: INFO
        - name: COLLECTION_INTERVAL
          value: "3600"
        envFrom:
        - secretRef:
            name: aws-credentials-env
        resources:
          requests:
            cpu: 500m
            memory: 1Gi
          limits:
            cpu: "2"
            memory: 2Gi
      restartPolicy: OnFailure
