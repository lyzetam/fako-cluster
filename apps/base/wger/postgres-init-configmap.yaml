apiVersion: v1
kind: ConfigMap
metadata:
  name: wger-db-init
  namespace: postgres
data:
  init-wger.sql: |
    -- Create wger database if it doesn't exist
    SELECT 'CREATE DATABASE wger'
    WHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = 'wger')\gexec
    
    -- Create wger user if it doesn't exist
    DO $$
    BEGIN
      IF NOT EXISTS (SELECT FROM pg_user WHERE usename = 'wger') THEN
        CREATE USER wger WITH PASSWORD 'wger-password';
      END IF;
    END
    $$;
    
    -- Grant superuser privileges to wger (required for migrations)
    ALTER USER wger WITH SUPERUSER;
    
    -- Grant all privileges on database
    GRANT ALL PRIVILEGES ON DATABASE wger TO wger;