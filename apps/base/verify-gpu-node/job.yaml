# apps/base/verify-gpu-node/job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: verify-pgbee-node
  namespace: verify-gpu-node
spec:
  ttlSecondsAfterFinished: 3600
  template:
    spec:
      serviceAccountName: node-verifier
      restartPolicy: Never
      containers:
      - name: verifier
        image: bitnami/kubectl:latest
        command:
        - /bin/bash
        - -c
        - |
          echo "=== Verifying pgbee Node in Cluster ==="
          echo "Date: $(date)"
          echo ""
          
          echo "=== All Nodes in Cluster ==="
          kubectl get nodes -o wide
          echo ""
          
          echo "=== Checking if pgbee exists ==="
          if kubectl get node pgbee >/dev/null 2>&1; then
            echo "✅ Node pgbee found in cluster!"
            echo ""
            
            echo "=== Node Details ==="
            kubectl describe node pgbee | head -50
            echo ""
            
            echo "=== Node Conditions ==="
            kubectl get node pgbee -o json | jq '.status.conditions'
            echo ""
            
            echo "=== Node System Info ==="
            kubectl get node pgbee -o json | jq '.status.nodeInfo'
          else
            echo "❌ Node pgbee NOT found in cluster!"
            echo ""
            echo "Please verify:"
            echo "1. The node name is correct"
            echo "2. The k3s agent is running on the node"
            echo "3. Network connectivity between nodes"
            echo ""
            echo "Run this on pgbee node to check agent status:"
            echo "sudo systemctl status k3s-agent"
          fi
          
          echo ""
          echo "=== Verification Complete ==="