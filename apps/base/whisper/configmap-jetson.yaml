# apps/base/whisper/configmap-jetson.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: whisper-jetson-configmap
  namespace: whisper
data:
  # Model configuration - using smaller model for Jetson
  MODEL: "small"  # Reduced from large to small for Jetson's memory constraints
  LANGUAGE: "en"
  COMPUTE_TYPE: "float16"  # Using float16 for GPU compatibility
  BEAM_SIZE: "1"
  
  # GPU Configuration for Jetson
  NVIDIA_VISIBLE_DEVICES: "0"  # Jetson only has GPU 0
  NVIDIA_DRIVER_CAPABILITIES: "compute,utility"
  CUDA_VISIBLE_DEVICES: "0"  # Jetson only has GPU 0
  
  # Wyoming protocol settings
  WYOMING_URI: "tcp://0.0.0.0:10300"
  
  # Cache directory for models
  HF_HOME: "/data/.cache"
  TRANSFORMERS_CACHE: "/data/.cache"
  
  # Additional stability settings optimized for Jetson
  VAD_THRESHOLD: "0.5"
  MIN_SPEECH_DURATION_MS: "250"
  MAX_SPEECH_DURATION_S: "20"  # Reduced from 30 to save memory
  SPEECH_PAD_MS: "400"
  
  # Performance optimizations for Jetson
  BATCH_SIZE: "1"  # Conservative batch size for low memory
  NUM_WORKERS: "1"  # Single worker to prevent memory issues
