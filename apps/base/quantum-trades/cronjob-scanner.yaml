apiVersion: batch/v1
kind: CronJob
metadata:
  name: options-scanner
  namespace: quantum-trades
spec:
  schedule: "30 6,9,11,13,15 * * 1-5"
  timeZone: "America/New_York"
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 10
  failedJobsHistoryLimit: 5
  jobTemplate:
    spec:
      ttlSecondsAfterFinished: 86400
      template:
        spec:
          restartPolicy: OnFailure
          imagePullSecrets:
          - name: dockerhub-registry
          containers:
          - name: scanner
            image: lzetam/quantum-trades-scanner:latest
            imagePullPolicy: Always
            # Command is built into the image (python -m app.cli.scanner)
            envFrom:
            - configMapRef:
                name: options-scanner-config
            env:
            - name: MASSIVE_API_KEY
              valueFrom:
                secretKeyRef:
                  name: quantum-trades-secrets
                  key: MASSIVE_API_KEY
            - name: OBSIDIAN_API_URL
              valueFrom:
                secretKeyRef:
                  name: obsidian-api
                  key: api_url
            - name: OBSIDIAN_API_KEY
              valueFrom:
                secretKeyRef:
                  name: obsidian-api
                  key: api_key
            - name: SIGNALS_SERVICE_URL
              value: "http://signals-service:8002"
            resources:
              requests:
                memory: "512Mi"
                cpu: "200m"
              limits:
                memory: "1Gi"
                cpu: "1000m"
