# # apps/base/ollama/exo-nodeport-service.yaml
# apiVersion: v1
# kind: Service
# metadata:
#   name: exo-openai-nodeport
#   namespace: ollama
#   labels:
#     app: exo-openai
#     component: external-access
# spec:
#   type: NodePort
#   ports:
#     - port: 52415
#       targetPort: 52415
#       nodePort: 32415  # External port for Home Assistant and other integrations
#       protocol: TCP
#       name: openai-api
#   selector:
#     # This will route to the same endpoint as exo-openai-endpoint
#     app: exo-openai-endpoint

# # apps/base/ollama/exo-nodeport-service.yaml (FIXED VERSION)
apiVersion: v1
kind: Service
metadata:
  name: exo-openai-nodeport
  namespace: ollama
  labels:
    app: exo-openai
    component: external-access
spec:
  type: NodePort
  ports:
    - port: 52415
      targetPort: 52415
      nodePort: 32415
      protocol: TCP
      name: openai-api
  # Remove selector since we're using endpoints directly
  # This will use the same endpoints as exo-openai-endpoint service
---
# Create endpoints that match the NodePort service
apiVersion: v1
kind: Endpoints
metadata:
  name: exo-openai-nodeport
  namespace: ollama
subsets:
  - addresses:
      - ip: ***NFS-IP-REMOVED***  # Your external Ollama cluster IP
    ports:
      - port: 52415
        name: openai-api