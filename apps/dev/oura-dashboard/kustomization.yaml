apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: dev-oura-dashboard
resources:
  # Include individual base resources except ingress
  - ../../base/oura-dashboard/namespace.yaml
  - ../../base/oura-dashboard/rbac.yaml
  - ../../base/oura-dashboard/rbac-additions.yaml
  - ../../base/oura-dashboard/secret-store.yaml
  - ../../base/oura-dashboard/aws-secret-store.yaml
  - ../../base/oura-dashboard/external-secret-aws.yaml
  - ../../base/oura-dashboard/external-secret-oauth2.yaml
  - ../../base/oura-dashboard/oauth2-proxy.yaml
  - ../../base/oura-dashboard/oauth2-proxy-service.yaml
  - ../../base/oura-dashboard/configmap.yaml
  - ../../base/oura-dashboard/deployment.yaml
  - ../../base/oura-dashboard/service.yaml
  # Dev-specific resources
  - aws-credentials-secret-local.yaml
  - ingress.yaml  # Dev ingress without TLS

patches:
  - target:
      kind: SecretStore
      name: local-secret-store
    patch: |-
      - op: replace
        path: /spec/provider/kubernetes/remoteNamespace
        value: keycloak
  - path: oauth2-proxy-dev-patch.yaml
    target:
      kind: Deployment
      name: oauth2-proxy
