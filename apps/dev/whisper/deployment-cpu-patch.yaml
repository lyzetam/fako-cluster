apiVersion: apps/v1
kind: Deployment
metadata:
  name: whisper-gpu
  namespace: whisper
spec:
  template:
    spec:
      # Remove GPU node selector
      nodeSelector: {}
      
      # Remove GPU tolerations
      tolerations: []
      
      # Remove nvidia RuntimeClass
      runtimeClassName: null
      
      containers:
      - name: whisper
        # Use CPU version of whisper
        image: rhasspy/wyoming-whisper:latest
        env:
        # Remove GPU-specific environment variables
        - name: NVIDIA_VISIBLE_DEVICES
          $patch: delete
        - name: NVIDIA_DRIVER_CAPABILITIES
          $patch: delete
        - name: COMPUTE_TYPE
          value: "int8"  # CPU-optimized compute type
        - name: MODEL
          value: "tiny"  # Keep smallest model for CPU
        - name: BEAM_SIZE
          value: "1"  # Minimal beam size for CPU
        
        resources:
          requests:
            memory: "1Gi"
            cpu: "1000m"
            nvidia.com/gpu: null  # Remove GPU request
          limits:
            memory: "2Gi"
            cpu: "2000m"
            nvidia.com/gpu: null  # Remove GPU limit
