# Fix permission issues with ollama models directory
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ollama-gpu
  namespace: ollama
spec:
  template:
    spec:
      # Remove fsGroup to allow root access
      securityContext: {}
      initContainers:
      # Add init container to fix permissions
      - name: fix-permissions
        image: busybox:latest
        command: ['sh', '-c']
        args:
          - |
            echo "Fixing permissions for ollama models directory..."
            # Ensure the directory exists and has correct permissions
            mkdir -p /root/.ollama
            # Set ownership to root:root (UID 0:0)
            chown -R 0:0 /root/.ollama
            # Set permissions to allow root full access
            chmod -R 700 /root/.ollama
            echo "Permissions fixed."
        volumeMounts:
        - mountPath: /root/.ollama
          name: ollama-models
        securityContext:
          runAsUser: 0
          runAsGroup: 0
