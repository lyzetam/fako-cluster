# This file contains templates that will be processed by the job
apiVersion: v1
kind: ConfigMap
metadata:
  name: storageclass-templates
  namespace: nfs-system
data:
  nfs-csi-v3.yaml: |
    apiVersion: storage.k8s.io/v1
    kind: StorageClass
    metadata:
      name: nfs-csi-v3
      annotations:
        storageclass.kubernetes.io/is-default-class: "false"
    provisioner: nfs.csi.k8s.io
    parameters:
      server: "${NFS_SERVER}"
      share: "${NFS_STORAGE_PATH}"
    reclaimPolicy: Retain
    allowVolumeExpansion: true
    mountOptions:
      - nfsvers=3
      - nolock

  nfs-postgres-v3.yaml: |
    apiVersion: storage.k8s.io/v1
    kind: StorageClass
    metadata:
      name: nfs-postgres-v3
    provisioner: nfs.csi.k8s.io
    parameters:
      server: "${NFS_SERVER}"
      share: "${NFS_DB_PATH}"
      mountPermissions: "0777"
    reclaimPolicy: Retain
    allowVolumeExpansion: true
    mountOptions:
      - nfsvers=3
      - nolock
      - hard
      - rw
      - rsize=1048576
      - wsize=1048576
      - timeo=600
      - retrans=2
      - noresvport

  nfs-backup-v3.yaml: |
    apiVersion: storage.k8s.io/v1
    kind: StorageClass
    metadata:
      name: nfs-backup-v3
    provisioner: nfs.csi.k8s.io
    parameters:
      server: "${NFS_SERVER}"
      share: "${NFS_BACKUP_PATH}"
    reclaimPolicy: Retain
    allowVolumeExpansion: true
    mountOptions:
      - nfsvers=3      - nolock
